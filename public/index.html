<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - User Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* bg-gray-900 */
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen">

    <div id="root"></div>

    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState } = React;

        // --- Reusable Input Field Component ---
        function InputField({ label, name, type = 'text', value, onChange, required = false, autoComplete = "" }) {
            return (
                <div>
                    <label htmlFor={name} className="block text-sm font-medium text-gray-300 mb-1">{label}</label>
                    <input
                        type={type}
                        name={name}
                        id={name}
                        value={value}
                        onChange={onChange}
                        required={required}
                        autoComplete={autoComplete}
                        className="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500"
                    />
                </div>
            );
        }

        // --- Login Form Component ---
        function LoginForm({ onRegisterClick, onError }) {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [isLoading, setIsLoading] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setIsLoading(true);
                onError(null); // Clear previous errors

                try {
                    const response = await fetch('/users/login', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email, password }),
                    });

                    const data = await response.json();
                    if (!response.ok) {
                        throw new Error(data.error || 'Login failed');
                    }
                    
                    // SUCCESS! Save token and redirect
                    localStorage.setItem('authToken', data.token);
                    window.location.href = '/dashboard.html';

                } catch (err) {
                    setIsLoading(false);
                    onError(err.message);
                }
            };

            return (
                <form onSubmit={handleSubmit} className="space-y-4">
                    <InputField label="Email" name="email" type="email" value={email} onChange={(e) => setEmail(e.target.value)} required autoComplete="email" />
                    <InputField label="Password" name="password" type="password" value={password} onChange={(e) => setPassword(e.target.value)} required autoComplete="current-password" />
                    <div className="pt-2">
                        <button type="submit" disabled={isLoading} className="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg transition disabled:opacity-50">
                            {isLoading ? 'Logging in...' : 'Login'}
                        </button>
                    </div>
                    <p className="text-center text-sm text-gray-400">
                        Don't have an account?{' '}
                        <button type="button" onClick={onRegisterClick} className="font-medium text-purple-400 hover:text-purple-300">
                            Register here
                        </button>
                    </p>
                </form>
            );
        }

        // --- Register Form Component ---
        function RegisterForm({ onLoginClick, onError }) {
            const [formData, setFormData] = useState({ firstName: '', lastName: '', email: '', password: '' });
            const [isLoading, setIsLoading] = useState(false);
            const [message, setMessage] = useState('');

            const handleChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({ ...prev, [name]: value }));
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                setIsLoading(true);
                onError(null);
                setMessage('');

                try {
                    const response = await fetch('/users', { // This is your createUser endpoint
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData),
                    });

                    const data = await response.json();
                    if (!response.ok) {
                        throw new Error(data.error || 'Registration failed');
                    }
                    
                    // SUCCESS! Show message and switch to login
                    setMessage('Registration successful! Please log in.');
                    setTimeout(onLoginClick, 2000); // Switch to login after 2s

                } catch (err) {
                    setIsLoading(false);
                    onError(err.message);
                }
            };

            return (
                <form onSubmit={handleSubmit} className="space-y-4">
                    {message && <div className="text-green-400 text-center">{message}</div>}
                    <div className="flex gap-4">
                        <InputField label="First Name" name="firstName" value={formData.firstName} onChange={handleChange} required autoComplete="given-name" />
                        <InputField label="Last Name" name="lastName" value={formData.lastName} onChange={handleChange} required autoComplete="family-name" />
                    </div>
                    <InputField label="Email" name="email" type="email" value={formData.email} onChange={handleChange} required autoComplete="email" />
                    <InputField label="Password (New)" name="password" type="password" value={formData.password} onChange={handleChange} required autoComplete="new-password" />
                    
                    <div className="pt-2">
                        <button type="submit" disabled={isLoading} className="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg transition disabled:opacity-50">
                            {isLoading ? 'Registering...' : 'Register'}
                        </button>
                    </div>
                    <p className="text-center text-sm text-gray-400">
                        Already have an account?{' '}
                        <button type="button" onClick={onLoginClick} className="font-medium text-purple-400 hover:text-purple-300">
                            Login here
                        </button>
                    </p>
                </form>
            );
        }

        // --- Main App to toggle forms ---
        function App() {
            const [isRegister, setIsRegister] = useState(false);
            const [error, setError] = useState(null);

            return (
                <div className="bg-gray-800 rounded-lg shadow-xl w-full max-w-md p-6 sm:p-8 border border-gray-700">
                    <h2 className="text-2xl font-bold mb-6 text-center text-white">
                        {isRegister ? 'Create Account' : 'Welcome Back'}
                    </h2>
                    
                    {error && (
                        <div className="bg-red-500/20 border border-red-500 text-red-300 px-4 py-3 rounded-lg relative mb-6 text-sm" role="alert">
                            <strong>Error:</strong> {error}
                        </div>
                    )}

                    {isRegister ? (
                        <RegisterForm onLoginClick={() => { setIsRegister(false); setError(null); }} onError={setError} />
                    ) : (
                        <LoginForm onRegisterClick={() => { setIsRegister(true); setError(null); }} onError={setError} />
                    )}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>